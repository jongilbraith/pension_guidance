<% content_for(:page_title, t('service.title', page_title: 'Your details')) %>

<div class="l-column-two-thirds">
  <%= f.hidden_field :start_at, id: 'hidden_appointment_start_at_step_3' %>

  <h2 class="slot-picker-header">Your details</h2>

  <div class="form-group <%= 'form-group-error' if @appointment.errors.include?(:first_name) %>">
    <%= f.label :first_name, class: 'form-label-bold' %>
    <% if @appointment.errors.include?(:first_name) %>
      <span class="error-message"><%= @appointment.errors[:first_name].to_sentence.capitalize %></span>
    <% end %>
    <%= f.text_field :first_name, class: "t-first-name form-control #{'form-control-error' if @appointment.errors.include?(:first_name)}" %>
  </div>

  <div class="form-group <%= 'form-group-error' if @appointment.errors.include?(:last_name) %>">
    <%= f.label :last_name, class: 'form-label-bold' %>
    <% if @appointment.errors.include?(:last_name) %>
      <span class="error-message"><%= @appointment.errors[:last_name].to_sentence.capitalize %></span>
    <% end %>
    <%= f.text_field :last_name, class: "t-last-name form-control #{'form-control-error' if @appointment.errors.include?(:last_name)}" %>
  </div>

  <div class="form-group <%= 'form-group-error' if @appointment.errors.include?(:email) %>">
    <%= f.label :email, class: 'form-label-bold' do %>
      Email
      <span class="form-hint">Weâ€™ll send an email confirming your appointment date</span>
    <% end %>

    <% if @appointment.errors.include?(:email) %>
      <span class="error-message"><%= @appointment.errors[:email].to_sentence.capitalize %></span>
    <% end %>

    <div class="email-outer">
      <%= f.email_field :email, class: "t-email form-control #{'form-control-error' if @appointment.errors.include?(:email)}", data: email_validation_data_attributes %>
    </div>
  </div>

  <div class="form-group <%= 'form-group-error' if @appointment.errors.include?(:date_of_birth) %>">
    <fieldset>
      <legend>
        <span class="form-label-bold">
          Date of birth
        </span>
        <span class="form-hint" id="dob-hint">You must be aged 50 or over to book an appointment, eg 31 3 1950</span>
      </legend>
      <div class="form-date" id="appointment_date_of_birth" tabindex="-1">
        <div class="form-group form-group-day">
          <label class="form-label" for="<%= f.object_name %>_date_of_birth_day">Day</label>
          <%=
            f.number_field(
              'date_of_birth_day',
              id: "#{f.object_name}_date_of_birth_day",
              use_label: false,
              value: f.object.date_of_birth.try(:day),
              placeholder: 'DD',
              class: "f-dob__input form-control js-dob-day t-date-of-birth-day #{'form-control-error' if @appointment.errors.include?(:date_of_birth)}",
              pattern: '[0-9]*',
              min: 1,
              max: 31,
              'aria-describedby': 'dob-hint'
            )
          %>
        </div>
        <div class="form-group form-group-month">
          <label class="form-label" for="<%= f.object_name %>_date_of_birth_month">Month</label>
          <%=
            f.number_field(
              'date_of_birth_month',
              id: "#{f.object_name}_date_of_birth_month",
              use_label: false,
              value: f.object.date_of_birth.try(:month),
              placeholder: 'MM',
              class: "form-dob__input form-control js-dob-month t-date-of-birth-month #{'form-control-error' if @appointment.errors.include?(:date_of_birth)}",
              pattern: '[0-9]*',
              min: 1,
              max: 12
            )
          %>
        </div>
        <div class="form-group form-group-year">
          <label class="form-label" for="<%= f.object_name %>_date_of_birth_year">Year</label>
          <%=
            f.number_field(
              'date_of_birth_year',
              id: "#{f.object_name}_date_of_birth_year",
              use_label: false,
              value: f.object.date_of_birth.try(:year),
              placeholder: 'YYYY',
              class: "form-dob__input form-control form-dob__input--year js-dob-year t-date-of-birth-year #{'form-control-error' if @appointment.errors.include?(:date_of_birth)}",
              pattern: '[0-9]*',
              min: 120.years.ago.year,
              max: Date.today.year
            )
          %>
        </div>
      </div>
      <% if @appointment.errors.include?(:date_of_birth) %>
        <span class="error-message"><%= @appointment.errors[:date_of_birth].to_sentence.capitalize %></span>
      <% end %>
    </fieldset>
  </div>

  <div class="form-group <%= 'form-group-error' if @appointment.errors.include?(:opt_out_of_market_research) %>">
    <fieldset>
      <legend>
        <% if @appointment.errors.include?(:opt_in) %>
          <span class="error-message"><%= @appointment.errors[:opt_out_of_market_research].to_sentence.capitalize %></span>
        <% end %>
      </legend>
      <div class="multiple-choice">
        <%= f.check_box :opt_out_of_market_research, class: 't-opt-out-of-market-research' %>
        <%= f.label :opt_out_of_market_research, class: 't-opt-in' do %>
          I don't want to be contacted in the future
          <span class="form-hint">If you don't want to tell us about your experience of Pension Wise</span>
        <% end %>
      </div>
    </fieldset>
  </div>

  <div class="form-group">
    <%= f.submit 'Confirm appointment', class: 'button t-submit', data: { disable_with: 'Please wait...' } %>
  </div>
</div>
<div class="l-column-third">
  <h2 class="slot-picker-header">Your requested appointment</h2>
  <div class="slot-picker-confirmed-date">
    <p class="slot-picker-confirmed-date__text"><b><%= l(@appointment.start_at, format: :govuk_date) %></b></p>
    <p class="slot-picker-confirmed-date__text"><%= l(@appointment.start_at, format: :govuk_time) %>, 45 to 60 minutes</p>
  </div>

  <p><%= link_to('Change date/time', new_tesco_appointment_path) %></p>
</div>
